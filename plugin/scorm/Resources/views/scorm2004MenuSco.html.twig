{% macro renderMenu(scos) %}
    <ul>
    {% for sco in scos %}

        {% if sco.getIsBlock() %}
            {% set scoChildren = sco.getScoChildren() %}
            <li><b>{{ sco.getTitle() }}</b></li>

            {% if scoChildren is not null %}
                {{ _self.renderMenu(scoChildren) }}
            {% endif %}

        {% else %}
            <li sco-id="{{sco.getId()}}">
                <a href="{{ path('claro_render_scorm_2004_sco', {'scoId': sco.getId()}) }}"
                   class="sco-menu-link">
                    {{ sco.getTitle() }}
                </a>
            </li>
        {% endif %}
    {% endfor %}
    </ul>
{% endmacro %}

{% from _self import renderMenu %}

{% set layout = "ClarolineCoreBundle:Workspace:layout.html.twig" %}

{% if isDesktop() %}
    {% set layout = "ClarolineCoreBundle:Desktop:layout.html.twig" %}
{% endif %}

{% extends layout %}

{% block javascripts %}
    <script>
        window.trackingDetails = {{ scoTrackingDetails|raw }};
    </script>
    {{ parent() }}
    <script> load({{ chunks('claroline-distribution-plugin-scorm-scorm-2004-api')|raw }}) </script>
    <script> load({{ chunks('claroline-distribution-plugin-scorm-scorm-2004-menu-sco')|raw }}) </script>
{% endblock %}

{% block section_content %}
    <div class="panel-heading clearfix">
        <h3 class="panel-title">
            {{ currentSco.getTitle() }}
            {% if canEdit %}
                <a class="btn btn-default btn-sm pull-right"
                   href="{{ path('claro_scorm_results', {'resourceNode': resource.getResourceNode().getId()}) }}"
                   data-toggle="tooltip"
                   data-placement="top"
                   title="{{ 'display_results'|trans({}, 'scorm') }}"
                >
                    <i class="fa fa-list"></i>
                </a>
            {% endif %}
        </h3>
    </div>
    <div class="panel-body">
        <i id="menu-display-btn" class="btn btn-default fa fa-list pull-left"></i>
        <div class="text-right">
            <a class="btn btn-primary pointer-hand" onClick="javascript:enterFullScreen()">
                <i class="fa fa-expand"></i>
            </a>
        </div>
        <br>
        <div class="row">
            <div id="menu-box" class="col-md-3 menu-style hidden">
                <div id="scorm-menu">
                    {{ renderMenu(scos) }}
                    <br>
                    <div class="center-text">
                        <a href="{{ path('claro_render_scorm_2004_resource', {'scormId': resource.getId(), 'mode': 1}) }}"
                           class="btn btn-default">
                            {{ 'quit'|trans({}, 'resource') }}
                        </a>
                    </div>
                    <br>
                </div>
            </div>
            <div id="content-box" class="col-md-12">
                <div class="full-size">
                    <div id="twig-scorm-data"
                         data-sco-id="{{scoTracking.getSco().getId()}}">
                    </div>
                    <iframe id="scorm-frame"
                            allowfullscreen
                            class="full-size"
                            src="{{ asset(scormUrl) }}"
                            frameborder="0"
                    >
                    </iframe>
                </div>
            </div>
        </div>
    </div>
    <style>
        .menu-style {
            height: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            border-right: 10px solid #DEDCDA;
            margin-left: 0px;
            padding-left: 0px;
        }
        .full-size {
            height: 100%;
            width: 100%;
        }
    </style>
{% endblock %}
